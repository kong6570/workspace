<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.up366.auth.db.dao.PositionDefMapper">
  <resultMap id="BaseResultMap" type="com.up366.auth.db.pojo.PositionDef">
    <id column="pst_def_id" jdbcType="INTEGER" property="pstDefId" />
    <result column="pst_def_name" jdbcType="VARCHAR" property="pstDefName" />
    <result column="org_type" jdbcType="INTEGER" property="orgType" />
    <result column="diaplay_order" jdbcType="INTEGER" property="diaplayOrder" />
    <result column="pst_def_desc" jdbcType="VARCHAR" property="pstDefDesc" />
    <result column="user_type" jdbcType="INTEGER" property="userType" />
  </resultMap>
  <sql id="Base_Column_List">
    pst_def_id, pst_def_name, org_type, diaplay_order, pst_def_desc, user_type
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="BaseResultMap">
    select 
    <include refid="Base_Column_List" />
    from adm_positions_def
    where pst_def_id = #{pstDefId,jdbcType=INTEGER}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
    delete from adm_positions_def
    where pst_def_id = #{pstDefId,jdbcType=INTEGER}
  </delete>
  <insert id="insert" parameterType="com.up366.auth.db.pojo.PositionDef">
    insert into adm_positions_def (pst_def_id, pst_def_name, org_type, 
      diaplay_order, pst_def_desc, user_type
      )
    values (#{pstDefId,jdbcType=INTEGER}, #{pstDefName,jdbcType=VARCHAR}, #{orgType,jdbcType=INTEGER}, 
      #{diaplayOrder,jdbcType=INTEGER}, #{pstDefDesc,jdbcType=VARCHAR}, #{userType,jdbcType=INTEGER}
      )
  </insert>
  <insert id="insertSelective" parameterType="com.up366.auth.db.pojo.PositionDef">
    insert into adm_positions_def
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="pstDefId != null">
        pst_def_id,
      </if>
      <if test="pstDefName != null">
        pst_def_name,
      </if>
      <if test="orgType != null">
        org_type,
      </if>
      <if test="diaplayOrder != null">
        diaplay_order,
      </if>
      <if test="pstDefDesc != null">
        pst_def_desc,
      </if>
      <if test="userType != null">
        user_type,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="pstDefId != null">
        #{pstDefId,jdbcType=INTEGER},
      </if>
      <if test="pstDefName != null">
        #{pstDefName,jdbcType=VARCHAR},
      </if>
      <if test="orgType != null">
        #{orgType,jdbcType=INTEGER},
      </if>
      <if test="diaplayOrder != null">
        #{diaplayOrder,jdbcType=INTEGER},
      </if>
      <if test="pstDefDesc != null">
        #{pstDefDesc,jdbcType=VARCHAR},
      </if>
      <if test="userType != null">
        #{userType,jdbcType=INTEGER},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.up366.auth.db.pojo.PositionDef">
    update adm_positions_def
    <set>
      <if test="pstDefName != null">
        pst_def_name = #{pstDefName,jdbcType=VARCHAR},
      </if>
      <if test="orgType != null">
        org_type = #{orgType,jdbcType=INTEGER},
      </if>
      <if test="diaplayOrder != null">
        diaplay_order = #{diaplayOrder,jdbcType=INTEGER},
      </if>
      <if test="pstDefDesc != null">
        pst_def_desc = #{pstDefDesc,jdbcType=VARCHAR},
      </if>
      <if test="userType != null">
        user_type = #{userType,jdbcType=INTEGER},
      </if>
    </set>
    where pst_def_id = #{pstDefId,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.up366.auth.db.pojo.PositionDef">
    update adm_positions_def
    set pst_def_name = #{pstDefName,jdbcType=VARCHAR},
      org_type = #{orgType,jdbcType=INTEGER},
      diaplay_order = #{diaplayOrder,jdbcType=INTEGER},
      pst_def_desc = #{pstDefDesc,jdbcType=VARCHAR},
      user_type = #{userType,jdbcType=INTEGER}
    where pst_def_id = #{pstDefId,jdbcType=INTEGER}
  </update>
  
  <!-- 
      author:张静转
      time:2016-01-23 16:28:12
      remark：根据岗位类型，获取预设岗位信息列表
   -->
  <select id="findAllByOrgType" parameterType="java.lang.Integer" resultMap="BaseResultMap">
    select
	<include refid="Base_Column_List" />
	from adm_positions_def
	where org_type = #{_parameter,jdbcType=INTEGER}
  </select>
 
	<!--  	
		author:denglinfan
	  	date:2016/1/19 20:38
  		remark:根据机构类型查询预设岗位的数量
    -->
   <select id="getCountForPositionsDef" parameterType="java.util.Map" resultType="java.lang.Integer">
   		select count(*) from adm_positions_def where 1=1
   		<if test="orgType != null">
   		and org_type = #{orgType,jdbcType=INTEGER}
   		</if>
   		<if test="pstDefName != null">
	   		and pst_def_name like CONCAT('%',#{pstDefName,jdbcType=VARCHAR},'%')
   		</if>
   </select>
   
   <!-- 
	   	author:denglinfan
	   	date:2016/1/20 9:06
	   	remark:分页查询所有预设岗位信息（可能会有带条件的情况）
    -->
    <select id="toShowPositionsDef" parameterType="java.util.Map" resultMap="BaseResultMap">
    	select 
    	<include refid="Base_Column_List" />
    	from adm_positions_def where 1=1
    	<if test="orgType != null">
    	 and org_type = #{orgType,jdbcType=INTEGER}
    	</if>
    	<if test="pstDefName != null">
	   	 and pst_def_name like CONCAT('%',#{pstDefName,jdbcType=VARCHAR},'%')
    	</if>
    	order by pst_def_id desc 
    	limit #{pageNo,jdbcType=INTEGER} , #{pageSize,jdbcType=INTEGER}    	
    </select>
    
    <!-- 
	   	author:denglinfan
	   	date:2016/1/20 16:47
	   	remark:检查新增的岗位代码是否重复
    -->
    <select id="checkDefIdIsRepeat" parameterType="integer" resultType="integer">
    	select count(*) from adm_positions_def 
    	where pst_def_id=#{_paramter.pstDefId,jdbcType=INTEGER}
    </select>
    
     <!-- 
    	author:denglinfan
    	date:2016/1/21 10:04
    	remark:分页展示所有的预设岗位信息（关联查询机构类型表）
     -->
     <select id="showPositionsDefByMap" parameterType="java.util.Map" resultType="map">
     	select 
    	<include refid="Base_Column_List" />
    	,org_type_name,user_type_name
    	from adm_positions_def po,adm_org_types org,adm_user_types ut where 1=1 
    	and po.org_type=org.org_type_id
    	and po.user_type=ut.user_type_id
    	<if test="orgType != null">
    	 and org_type = #{orgType,jdbcType=INTEGER}
    	</if>
    	<if test="pstDefName != null">
	   	 and pst_def_name like CONCAT('%',#{pstDefName,jdbcType=VARCHAR},'%')
    	</if>
    	order by pst_def_id desc 
    	limit #{pageNo,jdbcType=INTEGER} , #{pageSize,jdbcType=INTEGER} 
     </select>
     
     <!-- 
     	author:denglinfan
     	date:2016/1/26 19:47
     	remark:根据机构id查询正式岗位中不存在的预设岗位的信息
      -->
      
<!--      <select id="findPosDefNotInPos" parameterType="map" resultType="map">-->
<!--      	select pst_def_id,pst_def_name from adm_positions_def-->
<!--      	where org_type=-->
<!--      	(select org_type_id from adm_organs where org_id = #{orgId,jdbcType=BIGINT})-->
<!--      	and  pst_def_id not in(select DISTINCT pst_def_id from adm_positions -->
<!--      	where org_id = #{orgId,jdbcType=BIGINT})-->
<!--      	and user_type = (select user_type from adm_users where user_id = #{userId,jdbcType=BIGINT})-->
<!--      </select>-->
      
      
	<!-- 
	  	remark:根据机构类型名称查询
		author:赵云慧
		date:2016-1-22 13:45:51
	   -->
	<select id="getDefList" resultMap="BaseResultMap" parameterType="map">
		SELECT  <include refid="Base_Column_List" /> 
		from adm_positions_def apd WHERE apd.org_type = #{orgTypeId,jdbcType=INTEGER}
		and apd.pst_def_id
 		not in (
			SELECT ap.pst_def_id from adm_positions ap WHERE ap.org_id=#{orgId,jdbcType=BIGINT} and ap.pst_def_id >0
		)
		limit #{pageNo, jdbcType=INTEGER} , #{pageSize, jdbcType=INTEGER}
	</select>
	
	<!-- 
	remark:根据机构类型名称得到预设岗位总数
	author:赵云慧
	date:2016-1-22 13:45:51
	-->
	<select id="getDefCount" resultType="integer" parameterType="map">
		SELECT  count(1) 
		from adm_positions_def apd WHERE apd.org_type = #{orgTypeId,jdbcType=INTEGER}
		and apd.pst_def_id
 		not in (
			SELECT ap.pst_def_id from adm_positions ap WHERE ap.org_id=#{orgId,jdbcType=BIGINT} and ap.pst_def_id >0
		)

	</select>

	<!-- 
		remark:得到机构类型下面的用户类型数据
		author:denglinfan
		date:2016/1/28 16:26
	 -->
	 <select id="userTypeList" resultType="map" parameterType="integer">
	 	select user_type_id,user_type_name
	 	from adm_user_types where org_type_id =#{_paramter.orgTypeId,jdbcType=INTEGER}
	 </select>

</mapper>