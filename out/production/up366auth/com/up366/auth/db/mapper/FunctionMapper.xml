<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.up366.auth.db.dao.FunctionMapper" >
  <resultMap id="BaseResultMap" type="com.up366.auth.db.pojo.Function" >
    <id column="func_id" property="funcId" jdbcType="VARCHAR" />
    <result column="pid" property="pid" jdbcType="VARCHAR" />
    <result column="func_name" property="funcName" jdbcType="VARCHAR" />
    <result column="sys_id" property="sysId" jdbcType="VARCHAR" />
    <result column="group_id" property="groupId" jdbcType="VARCHAR" />
    <result column="module_id" property="moduleId" jdbcType="VARCHAR" />
    <result column="description" property="description" jdbcType="VARCHAR" />
    <result column="flevel" property="flevel" jdbcType="INTEGER" />
    <result column="display_order" property="displayOrder" jdbcType="INTEGER" />
    <result column="func_type" property="funcType" jdbcType="INTEGER" />
    <result column="is_enabled" property="isEnabled" jdbcType="INTEGER" />
    <result column="is_verify" property="isVerify" jdbcType="INTEGER" />
    <result column="owners_type" property="ownersType" jdbcType="VARCHAR" />
    <result column="target_url" property="targetUrl" jdbcType="VARCHAR" />
    <result column="target_type" property="targetType" jdbcType="INTEGER" />
    <result column="is_authorize" property="isAuthorize" jdbcType="INTEGER" />
  </resultMap>
  <resultMap id="BaseMenuMap" type="com.up366.auth.vo.Menu" >
    <id column="func_id" property="funcId" jdbcType="VARCHAR" />
    <result column="pid" property="pid" jdbcType="VARCHAR" />
    <result column="func_name" property="funcName" jdbcType="VARCHAR" />
    <result column="sys_id" property="sysId" jdbcType="VARCHAR" />
    <result column="group_id" property="groupId" jdbcType="VARCHAR" />
    <result column="module_id" property="moduleId" jdbcType="VARCHAR" />
    <result column="description" property="description" jdbcType="VARCHAR" />
    <result column="flevel" property="flevel" jdbcType="INTEGER" />
    <result column="display_order" property="displayOrder" jdbcType="INTEGER" />
    <result column="func_type" property="funcType" jdbcType="INTEGER" />
    <result column="is_enabled" property="isEnabled" jdbcType="INTEGER" />
    <result column="is_verify" property="isVerify" jdbcType="INTEGER" />
    <result column="owners_type" property="ownersType" jdbcType="VARCHAR" />
    <result column="target_url" property="targetUrl" jdbcType="VARCHAR" />
    <result column="target_type" property="targetType" jdbcType="INTEGER" />
    <result column="is_authorize" property="isAuthorize" jdbcType="INTEGER" />
  </resultMap>
  <sql id="Base_Column_List" >
    func_id, pid, func_name, sys_id, group_id, module_id, description, flevel, display_order, 
    func_type, is_enabled, is_verify, owners_type, target_url, target_type, is_authorize
  </sql>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.String" >
    select 
    <include refid="Base_Column_List" />
    from adm_functions
    where func_id = #{funcId,jdbcType=VARCHAR}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.String" >
    delete from adm_functions
    where func_id = #{funcId,jdbcType=VARCHAR}
  </delete>
  <insert id="insert" parameterType="com.up366.auth.db.pojo.Function" >
    insert into adm_functions (func_id, pid, func_name, 
      sys_id, group_id, module_id, 
      description, flevel, display_order, 
      func_type, is_enabled, is_verify, 
      owners_type, target_url, target_type, is_authorize
      )
    values (#{funcId,jdbcType=VARCHAR}, #{pid,jdbcType=VARCHAR}, #{funcName,jdbcType=VARCHAR}, 
      #{sysId,jdbcType=VARCHAR}, #{groupId,jdbcType=VARCHAR}, #{moduleId,jdbcType=VARCHAR}, 
      #{description,jdbcType=VARCHAR}, #{flevel,jdbcType=INTEGER}, #{displayOrder,jdbcType=INTEGER}, 
      #{funcType,jdbcType=INTEGER}, #{isEnabled,jdbcType=INTEGER}, #{isVerify,jdbcType=INTEGER}, 
      #{ownersType,jdbcType=VARCHAR}, #{targetUrl,jdbcType=VARCHAR}, #{targetType,jdbcType=INTEGER}, 
      #{isAuthorize,jdbcType=INTEGER}
      )
  </insert>
  <insert id="insertSelective" parameterType="com.up366.auth.db.pojo.Function" >
    insert into adm_functions
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="funcId != null" >
        func_id,
      </if>
      <if test="pid != null" >
        pid,
      </if>
      <if test="funcName != null" >
        func_name,
      </if>
      <if test="sysId != null" >
        sys_id,
      </if>
      <if test="groupId != null" >
        group_id,
      </if>
      <if test="moduleId != null" >
        module_id,
      </if>
      <if test="description != null" >
        description,
      </if>
      <if test="flevel != null" >
        flevel,
      </if>
      <if test="displayOrder != null" >
        display_order,
      </if>
      <if test="funcType != null" >
        func_type,
      </if>
      <if test="isEnabled != null" >
        is_enabled,
      </if>
      <if test="isVerify != null" >
        is_verify,
      </if>
      <if test="ownersType != null" >
        owners_type,
      </if>
      <if test="targetUrl != null" >
        target_url,
      </if>
      <if test="targetType != null" >
        target_type,
      </if>
      <if test="isAuthorize != null" >
        is_authorize,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="funcId != null" >
        #{funcId,jdbcType=VARCHAR},
      </if>
      <if test="pid != null" >
        #{pid,jdbcType=VARCHAR},
      </if>
      <if test="funcName != null" >
        #{funcName,jdbcType=VARCHAR},
      </if>
      <if test="sysId != null" >
        #{sysId,jdbcType=VARCHAR},
      </if>
      <if test="groupId != null" >
        #{groupId,jdbcType=VARCHAR},
      </if>
      <if test="moduleId != null" >
        #{moduleId,jdbcType=VARCHAR},
      </if>
      <if test="description != null" >
        #{description,jdbcType=VARCHAR},
      </if>
      <if test="flevel != null" >
        #{flevel,jdbcType=INTEGER},
      </if>
      <if test="displayOrder != null" >
        #{displayOrder,jdbcType=INTEGER},
      </if>
      <if test="funcType != null" >
        #{funcType,jdbcType=INTEGER},
      </if>
      <if test="isEnabled != null" >
        #{isEnabled,jdbcType=INTEGER},
      </if>
      <if test="isVerify != null" >
        #{isVerify,jdbcType=INTEGER},
      </if>
      <if test="ownersType != null" >
        #{ownersType,jdbcType=VARCHAR},
      </if>
      <if test="targetUrl != null" >
        #{targetUrl,jdbcType=VARCHAR},
      </if>
      <if test="targetType != null" >
        #{targetType,jdbcType=INTEGER},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.up366.auth.db.pojo.Function" >
    update adm_functions
    <set >
      <if test="pid != null" >
        pid = #{pid,jdbcType=VARCHAR},
      </if>
      <if test="funcName != null" >
        func_name = #{funcName,jdbcType=VARCHAR},
      </if>
      <if test="sysId != null" >
        sys_id = #{sysId,jdbcType=VARCHAR},
      </if>
      <if test="groupId != null" >
        group_id = #{groupId,jdbcType=VARCHAR},
      </if>
      <if test="moduleId != null" >
        module_id = #{moduleId,jdbcType=VARCHAR},
      </if>
      <if test="description != null" >
        description = #{description,jdbcType=VARCHAR},
      </if>
      <if test="flevel != null" >
        flevel = #{flevel,jdbcType=INTEGER},
      </if>
      <if test="displayOrder != null" >
        display_order = #{displayOrder,jdbcType=INTEGER},
      </if>
      <if test="funcType != null" >
        func_type = #{funcType,jdbcType=INTEGER},
      </if>
      <if test="isEnabled != null" >
        is_enabled = #{isEnabled,jdbcType=INTEGER},
      </if>
      <if test="isVerify != null" >
        is_verify = #{isVerify,jdbcType=INTEGER},
      </if>
      <if test="ownersType != null" >
        owners_type = #{ownersType,jdbcType=VARCHAR},
      </if>
      <if test="targetUrl != null" >
        target_url = #{targetUrl,jdbcType=VARCHAR},
      </if>
      <if test="targetType != null" >
        target_type = #{targetType,jdbcType=INTEGER},
      </if>
      <if test="isAuthorize != null" >
        is_authorize = #{isAuthorize,jdbcType=INTEGER},
      </if>
    </set>
    where func_id = #{funcId,jdbcType=VARCHAR}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.up366.auth.db.pojo.Function" >
    update adm_functions
    set pid = #{pid,jdbcType=VARCHAR},
      func_name = #{funcName,jdbcType=VARCHAR},
      sys_id = #{sysId,jdbcType=VARCHAR},
      group_id = #{groupId,jdbcType=VARCHAR},
      module_id = #{moduleId,jdbcType=VARCHAR},
      description = #{description,jdbcType=VARCHAR},
      flevel = #{flevel,jdbcType=INTEGER},
      display_order = #{displayOrder,jdbcType=INTEGER},
      func_type = #{funcType,jdbcType=INTEGER},
      is_enabled = #{isEnabled,jdbcType=INTEGER},
      is_verify = #{isVerify,jdbcType=INTEGER},
      owners_type = #{ownersType,jdbcType=VARCHAR},
      target_url = #{targetUrl,jdbcType=VARCHAR},
      target_type = #{targetType,jdbcType=INTEGER},
      is_authorize = #{isAuthorize,jdbcType=INTEGER}
    where func_id = #{funcId,jdbcType=VARCHAR}
  </update>
  
  <!-- 
  	author:denglinfan
  	date:2016/1/21 16:07
  	remark:查询所有权限信息
   -->
   <select id="findAllFuncMess" resultMap="BaseResultMap" parameterType="java.lang.String">
   	select
   	<include refid="Base_Column_List"></include>
   	from adm_functions
   	<if test="sysId!=null and sysId!=''">
   	where sys_id = #{sysId,jdbcType=VARCHAR}
   	</if>
   </select>
   
   <!-- 
   		author:denglinfan
	  	date:2016/1/21 16:07
	  	remark:查询当前数据库中，所有的需要分配权限的系统信息
    -->
    <select id="findAllSys" resultType="map">
    	select func_id,func_name from adm_functions where pid="" order by display_order
    </select>
    
     
  <!-- 
  	author:gxs
  	date:2016-1-21 10:42:05
  	desc:返回ztree的功能json
   -->
  <select id="getFuncMapList" resultType="map">
  	select func_id as id,pid as pId,func_name as name,target_url as url from adm_functions
  </select>
  
  
  <select id="getFunctionList" resultMap="BaseResultMap">
  	select func_id,pid,target_url,target_type,flevel,func_name from adm_functions 
  	where sys_id='001' and  flevel=2 order by display_order asc
  </select>
  <select id="getMenuList" resultMap="BaseMenuMap">
  	select func_id,pid,target_url,target_type,flevel,func_name 
  	from adm_functions
  	where sys_id='001' and  flevel=1
  	 order by display_order asc
  </select>
  
  <!--  
     @Description 查询出所有系统列表
     @return List<Function>
     @author byn
     @date 2016-1-21 10:50:04
   -->
  <select id="selectSystemList" resultMap="BaseResultMap"  parameterType="map">
    select  func_id ,func_name  from adm_functions where (pid is  null or pid='')
    <if test="functionName!=null">
		and func_name like CONCAT('%',#{functionName,jdbcType=VARCHAR},'%' )
  	</if>
		order by display_order
	<if test="pageNo!=null and pageSize!=null">
		limit #{pageNo, jdbcType=INTEGER} , #{pageSize, jdbcType=INTEGER}
	</if>    
  </select>
   <!--  
     @Description 查询出所有系统列表
     @return int
     @author byn
     @date 2016-1-21 10:50:04
   -->  
   <select id="selectSystemListCount" resultType="int"  parameterType="map">
    select  count(1)  from adm_functions where pid is  null or pid=''
    <if test="functionName!=null">
		and func_name like CONCAT('%',#{functionName,jdbcType=VARCHAR},'%' )
  	</if>
  </select>
  <!-- 
	  @Description 查询出所有功能列表
      @return List<Function>
      @author byn
      @date 2016-1-21 17:25:59
   --> 
  <select id="selectFunctionList" resultMap="BaseResultMap" parameterType="map">
        select  <include refid="Base_Column_List" />  from adm_functions where 1=1 
       <if test="sysId != null">
        and sys_id = #{sysId,jdbcType=VARCHAR}
      </if>
       <if test="pid != null" >
        and pid = #{pid,jdbcType=VARCHAR}
      </if>
      order by display_order
  </select>
  <!-- 
	  
   --> 
  <select id="selectFunctionListCount" resultType="int" parameterType="map">
       select  count(1)  from adm_functions where 
     <if test="sysId != null" >
        sys_id = #{sysId,jdbcType=VARCHAR},
      </if>
      <if test="flevel != null" >
        flevel = #{flevel,jdbcType=INTEGER}
      </if>
  </select>
   <!--  
     * @description:用系统Id和层级以及序列号查询功能列表
     * @param map
     * @return
     * @author byn
	 * @date 2016-1-28 21:02:16
     */
   -->
  <select id="selectByList" resultMap="BaseResultMap" parameterType="map">
        select  <include refid="Base_Column_List" />  from adm_functions where 1=1 
       <if test="pid != null">
        and pid = #{pid,jdbcType=VARCHAR}
      </if>
      <if test="pid==null">
         and pid is null
      </if>
      <if test="displayOrder != null" >
       and display_order = #{displayOrder,jdbcType=INTEGER}
      </if>
      order by display_order
  </select>
  
  <!-- 
  	 * @description:获取当前用户的功能列表
     * @param map
     * @return
     * @author 高新帅
	 * @date 2016-2-14 11:53:57
     */
   -->
  <select id="getFunctionListBySysList" resultMap="BaseResultMap" parameterType="map">
	 select  <include refid="Base_Column_List" />  from adm_functions where 1=1 
	 	<if test="funcType!=null">
	 	and func_type=#{funcType}
	 	</if>
       <if test="funcIdList != null">
        and func_id  in 
        	<foreach collection="funcIdList" item="funcId"  open="(" separator="," close=")">  
        		#{funcId}  
     		</foreach>  
      </if>
      <if test="sysIdList != null" >
      	and sys_id in  
        	<foreach collection="sysIdList" item="sysId"  open="(" separator="," close=")">  
        		#{sysId}  
     		</foreach>  
      </if>
      order by sys_id,group_id,display_order  
  </select>
  
  <select id="getAllFunction" resultMap="BaseResultMap">
   select  <include refid="Base_Column_List" />  from adm_functions 
  </select>
</mapper>